<!DOCTYPE html />

<html>
<head>
	<title>exporter.js</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="nocco.css" rel="stylesheet" media="all" type="text/css" />
	<script src="prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="jump_to">
				Jump To &hellip;
				<div id="jump_wrapper">
					<div id="jump_page">
							<a class="source" href="coeffanalyse.html">
								CoeffAnalyse.js
							</a>
							<a class="source" href="engine-11072018-current.html">
								engine-11072018-current.js
							</a>
							<a class="source" href="engine-13072018.html">
								engine-13072018.js
							</a>
							<a class="source" href="engine-30052018.html">
								engine-30052018.js
							</a>
							<a class="source" href="engine-30062018.html">
								engine-30062018.js
							</a>
							<a class="source" href="engine.html">
								engine.js
							</a>
							<a class="source" href="engine18062018.html">
								engine18062018.js
							</a>
							<a class="source" href="engine23052018.html">
								engine23052018.js
							</a>
							<a class="source" href="exporter.html">
								exporter.js
							</a>
							<a class="source" href="global.html">
								global.js
							</a>
							<a class="source" href="importer.html">
								importer.js
							</a>
							<a class="source" href="index.html">
								index.js
							</a>
							<a class="source" href="locationpicker.jquery.html">
								locationpicker.jquery.js
							</a>
							<a class="source" href="output.html">
								output.js
							</a>
							<a class="source" href="privacy-policy.html">
								privacy-policy.js
							</a>
							<a class="source" href="record.html">
								record.js
							</a>
							<a class="source" href="support.html">
								support.js
							</a>
							<a class="source" href="restored/exporterbackup.html">
								RESTORED\exporterBACKUP.js
							</a>
							<a class="source" href="restored/global-backup.html">
								RESTORED\global-BACKUP.js
							</a>
					</div>
				</div>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>exporter.js</h1>
					</th>
					<th class="code"></th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							
						</td>
						<td class="code">
							<pre><code class='prettyprint'>var NEWARRAYLENGTH = 5;	// what does this control? old value 5

var exportDataList = [];
var exportedData = [];
var exportedLegibleDataString = &quot;&quot;;
var exportString = &quot;&quot;;
 /* &lt;a href=&quot;../cgi-bin/exporter.pl&quot;&gt; RUN IT!&lt;/a&gt; */

</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p>create the data from the active list.
This is effectively backing up the entire database.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'> 
</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<p>TODO test possible partial selecting</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__buildExporterData() {
    $(&#39;nav select option:selected&#39;).each(function (index, value) {
        exportDataList[exportDataList.length] = value.text; //.replace(&#39; &#39;, &#39;-&#39;);
		console.log(exportDataList[exportDataList.length]);
        /* 	$(value).data(value.text.replace(&#39; &#39;,&#39;-&#39;), value.value); */
</code></pre>
						</td>
					</tr>
					<tr id="section_4">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_4">&#182;</a>
							</div>
							<pre><code>   exportedData[exportedData.length] = [value.text.replace(' ', '-'), value.value];  OLD way
</code></pre>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
		 exportedData[exportedData.length] = [value.text, value.value];

		
		
    })
	
	if (exportDataList.length == 0 ) 
	{
	
	   $(&#39;nav select option&#39;).each(function (index, value) {
        exportDataList[exportDataList.length] = value.text; //.replace(&#39; &#39;, &#39;-&#39;);
        /* 	$(value).data(value.text.replace(&#39; &#39;,&#39;-&#39;), value.value); */
</code></pre>
						</td>
					</tr>
					<tr id="section_5">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_5">&#182;</a>
							</div>
							<p>console.log(exportDataList[exportDataList.length-1]);</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	 exportedData[exportedData.length] = [value.text, value.value];
	
</code></pre>
						</td>
					</tr>
					<tr id="section_6">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_6">&#182;</a>
							</div>
							<p>exportedData[exportedData.length] = [value.text.replace(' ', '-'), value.value];</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>console.log(exportedData[exportedData.length-1]);
    })
	}
 	
	
	

</code></pre>
						</td>
					</tr>
					<tr id="section_7">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_7">&#182;</a>
							</div>
							<p>we now have our key pair data list...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    /* alert (exportedData); */

</code></pre>
						</td>
					</tr>
					<tr id="section_8">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_8">&#182;</a>
							</div>
							<p>Note about possible data size. We are okay with our 3 or 4 mb...    </p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    /* 	quote Message-ID: &lt;#C**************@TK2MSFTNGP12.phx.gbl&gt;
    In JScript, variant string variables have the same limit as in VBScript,
    up to 2^31 characters.

    String *literals* (as in &quot;this is a literal&quot;) have (IIRC) a limit ~2^10
    (1024) characters. */

    $.each(exportedData, function (index, value) {

</code></pre>
						</td>
					</tr>
					<tr id="section_9">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_9">&#182;</a>
							</div>
							<p>exportString += value + delimeter;   // OLD WAY</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
        exportString += value.join(&#39;|&#39;) + delimeter;

    })

</code></pre>
						</td>
					</tr>
					<tr id="section_10">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_10">&#182;</a>
							</div>
							<p>remove extra delimeter</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    exportString = exportString.slice(0, -1);

	
	
	
    /* alert(exportString); */
</code></pre>
						</td>
					</tr>
					<tr id="section_11">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_11">&#182;</a>
							</div>
							<p><em>f</em><em>ajax</em>text();</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>}
   
function _f__ajax_text() {
    var serverData = &quot;&quot;;
    var input = exportString;
    $.ajax({
        url: &quot;../cgi-bin/exporter.pl&quot;,
        type: &#39;POST&#39;,
        cache: false,
        data: {
            backup: input
        },
        success: function (serverData) {
            _f__handle_return(serverData);
        }
    });
}

var USEFUL_FILE_END_DELIMETER  = &quot;\n&quot;;

</code></pre>
						</td>
					</tr>
					<tr id="section_12">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_12">&#182;</a>
							</div>
							<p>This is now the working legible code.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__create_flat(returnedString) {
</code></pre>
						</td>
					</tr>
					<tr id="section_13">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_13">&#182;</a>
							</div>
							<p>we are going to walk over the list, unmangle it a couple of times and then push it back into the string</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_14">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_14">&#182;</a>
							</div>
							<p>so we dont only get the first match</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
</code></pre>
						</td>
					</tr>
					<tr id="section_15">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_15">&#182;</a>
							</div>
							<p>var re =  new RegExp('Â¬', 'gi');</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_16">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_16">&#182;</a>
							</div>
							<p>var tempstring = returnedString;</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>

</code></pre>
						</td>
					</tr>
					<tr id="section_17">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_17">&#182;</a>
							</div>
							<p>exportString = tempstring;</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	exportString = tempstring; //.replace(re, USEFUL_FILE_END_DELIMETER);;
	
}



var nameSelectionList = [];


</code></pre>
						</td>
					</tr>
					<tr id="section_18">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_18">&#182;</a>
							</div>
							<p>This is now the working importer code.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__handle_return(returnedString) {
	

	nameSelectionList = [];
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_19">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_19">&#182;</a>
							</div>
							<p>we are going to walk over the list, unmangle it a couple of times and then push it back into storage, raw;  Hot potato style.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	var updateCount = 0;
	
</code></pre>
						</td>
					</tr>
					<tr id="section_20">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_20">&#182;</a>
							</div>
							<p>var uncoded = returnedString.split(USEFUL<em>FILE</em>END_DELIMETER);</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
    var uncoded = returnedString.split(delimeter);

    var name = &quot;&quot;;

	var nameList = &quot;&quot;;
	
	
	
    $.each(uncoded, function (index, val) {

        var result = &quot;&quot;;

		
		
		
</code></pre>
						</td>
					</tr>
					<tr id="section_21">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_21">&#182;</a>
							</div>
							<p>val = val.replace(',-','--');</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		
</code></pre>
						</td>
					</tr>
					<tr id="section_22">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_22">&#182;</a>
							</div>
							<p>val = val.replace(', ','--');</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	
	 name = val.split(&#39;|&#39;)[0];
	
	
	var dataGetter = val.split(&#39;|&#39;)[1];
	
        var secondLeveluncoded = dataGetter.split(&#39;,&#39;);

</code></pre>
						</td>
					</tr>
					<tr id="section_23">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_23">&#182;</a>
							</div>
							<p>name = secondLeveluncoded[0];</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_24">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_24">&#182;</a>
							</div>
							<p>secondLeveluncoded.shift();</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_25">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_25">&#182;</a>
							</div>
							<p>$.each(secondLeveluncoded, function (index, val) {</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_26">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_26">&#182;</a>
							</div>
							<pre><code>  result += val //.trim(0, -1);
   result += ',';
</code></pre>

<p>})</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
		
		updateCount ++;
		
</code></pre>
						</td>
					</tr>
					<tr id="section_27">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_27">&#182;</a>
							</div>
							<p>remangle</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
</code></pre>
						</td>
					</tr>
					<tr id="section_28">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_28">&#182;</a>
							</div>
							<p>var myNewArray =  <em>f</em>_decode(result).trim(0, -1).split(',');</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_29">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_29">&#182;</a>
							</div>
							<p>var myNewArray = result.trim(0, -1).split(',');</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	var myNewArray = dataGetter.split(&#39;,&#39;);
		
		
</code></pre>
						</td>
					</tr>
					<tr id="section_30">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_30">&#182;</a>
							</div>
							<p>unmangle , again.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		var SubjectsValues =  [myNewArray[0], myNewArray[2], myNewArray[4],myNewArray[6], myNewArray[8],myNewArray[10], myNewArray[12], myNewArray[14], myNewArray[16],myNewArray[18], myNewArray[20], myNewArray[22]     ];
		
		var subjectProcessedData =  [myNewArray[1], myNewArray[3], myNewArray[5],myNewArray[7], myNewArray[9],myNewArray[11], myNewArray[13], myNewArray[15], myNewArray[17],myNewArray[19], myNewArray[21], myNewArray[23]     ];
		
		
		
</code></pre>
						</td>
					</tr>
					<tr id="section_31">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_31">&#182;</a>
							</div>
							<p>Needs to be 27 not 24?</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		var myShakyOptionsArray = myNewArray.slice(24);
		
</code></pre>
						</td>
					</tr>
					<tr id="section_32">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_32">&#182;</a>
							</div>
							<p>re-spruce name</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		name = name.replace(&#39;--&#39;,&#39;, &#39;);
		name = name.replace(&#39;,-&#39;,&#39;, &#39;);
		
		
		
</code></pre>
						</td>
					</tr>
					<tr id="section_33">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_33">&#182;</a>
							</div>
							<p>create useful selection list</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		
		nameSelectionList[nameSelectionList.length] =  name;
		
		
</code></pre>
						</td>
					</tr>
					<tr id="section_34">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_34">&#182;</a>
							</div>
							<p>create attractive report list</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		var addon = &quot;, &quot;;
		if(updateCount % 3 == 0)
		{
			addon = &quot; ...&lt;br /&gt;&quot;;
		}
		nameList += &quot;[&quot;+updateCount+&quot;: &quot;+ name+&quot;] &quot;+addon;
		
</code></pre>
						</td>
					</tr>
					<tr id="section_35">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_35">&#182;</a>
							</div>
							<p>save - dont look behind the curtain...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		_f__StorageSaveOperation(name,SubjectsValues,subjectProcessedData,myShakyOptionsArray   );

    })
	
	_f__updatedP(&quot;Updated &quot;+updateCount+&quot; Records for&lt;br /&gt;&quot;+nameList);
	
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_36">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_36">&#182;</a>
							</div>
							<p>by here we can have built a list - walk over this list and add the class "selected" to each record in the records list that matches the exact string in this list.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	setTimeout(function(){__f_SelectAndSave() }, 1);
	
	
	
}

function __f_SelectAndSave(){
	__f_SelectList(nameSelectionList); SaveCurrentSelectionWithName(fileInput.files[0].name.substr(0, fileInput.files[0].name.length-4));
	
	
}


function __f_SelectList(listToSelect){
	
	$(listToSelect).each( function(ind, val){     __f_SelectbyName(val)    }  )
	
}


function  __f_SelectbyName(nameToSelect)
{
	
	$(&#39;#person option&#39;).each( function(ind, val){  if (  $(val).text() == nameToSelect   ){    $(val).prop(&#39;selected&#39;, true)     }                        }  )
	
}




function _f__download(filename) {
	_f__buildExporterData();
	
  var element = document.createElement(&#39;a&#39;);
  element.setAttribute(&#39;href&#39;, &#39;data:text/plain;charset=utf-8,&#39; + encodeURIComponent(exportString));
  element.setAttribute(&#39;download&#39;, filename);

  element.style.display = &#39;none&#39;;
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}


function _f__downloadLegible(filename) {
	_f__buildExporterData();
	
</code></pre>
						</td>
					</tr>
					<tr id="section_37">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_37">&#182;</a>
							</div>
							<p><em>f</em><em>create</em>flat(exportString);
console.log(exportString)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
  var element = document.createElement(&#39;a&#39;);
  element.setAttribute(&#39;href&#39;, &#39;data:text/plain;charset=utf-8,&#39; + encodeURIComponent(exportString));
  element.setAttribute(&#39;download&#39;, filename);

  element.style.display = &#39;none&#39;;
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}


function _f__createDownloadableFile(filename, passedData) {
  var element = document.createElement(&#39;a&#39;);
  element.setAttribute(&#39;href&#39;, &#39;data:text/plain;charset=utf-8,&#39; + encodeURIComponent(passedData));
  element.setAttribute(&#39;download&#39;, filename);

  element.style.display = &#39;none&#39;;
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
  
}


</code></pre>
						</td>
					</tr>
					<tr id="section_38">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_38">&#182;</a>
							</div>
							<p>Todo ADD FLOOD CONTROL</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SendSaveRequest() {
    $.ajax({
        type: &quot;POST&quot;,
        cache: false,
        url: &quot;exporter.pl&quot;,
        processData: false,
        contentType: &#39;application/json&#39;,
        dataType: &#39;json&#39;,
        data: {
            backup: exportString
        }, // multiple data sent using ajax
        success: function (html) {

            /*   $(&#39;#add&#39;).val(&#39;data sent sent&#39;); */

            alert(html);

            /*    $(&#39;#msg&#39;).html(html); */
        }
    });
    return false;

}
</code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
