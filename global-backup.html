<!DOCTYPE html />

<html>
<head>
	<title>global-BACKUP.js</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<link href="nocco.css" rel="stylesheet" media="all" type="text/css" />
	<script src="prettify.js" type="text/javascript"></script>
</head>
<body onload="prettyPrint()">
	<div id="container">
		<div id="background"></div>
			<div id="jump_to">
				Jump To &hellip;
				<div id="jump_wrapper">
					<div id="jump_page">
							<a class="source" href="coeffanalyse.html">
								CoeffAnalyse.js
							</a>
							<a class="source" href="engine.html">
								engine.js
							</a>
							<a class="source" href="exporter.html">
								exporter.js
							</a>
							<a class="source" href="exporterbackup.html">
								exporterBACKUP.js
							</a>
							<a class="source" href="global-backup.html">
								global-BACKUP.js
							</a>
							<a class="source" href="global.html">
								global.js
							</a>
							<a class="source" href="index.html">
								index.js
							</a>
							<a class="source" href="locationpicker.jquery.html">
								locationpicker.jquery.js
							</a>
							<a class="source" href="output.html">
								output.js
							</a>
							<a class="source" href="privacy-policy.html">
								privacy-policy.js
							</a>
							<a class="source" href="record.html">
								record.js
							</a>
							<a class="source" href="removed-engine-lint.html">
								removed-engine-lint.js
							</a>
							<a class="source" href="support.html">
								support.js
							</a>
					</div>
				</div>
			</div>
		<table cellpadding="0" cellspacing="0">
			<thead>
				<tr>
					<th class="docs">
						<h1>global-BACKUP.js</h1>
					</th>
					<th class="code"></th>
				</tr>
			</thead>
			<tbody>
					<tr id="section_1">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_1">&#182;</a>
							</div>
							<p>GLOBAL VALUE REFS</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>var SubjectProcessedData;
var TargetsProcessedData;
var SubjectsValues = new Array();
var TargetsValues = new Array();

var response = &quot;&quot;;

var oldUkLatValue = 0;
var oldUkLonValue = 0;

</code></pre>
						</td>
					</tr>
					<tr id="section_2">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_2">&#182;</a>
							</div>
							<p>add logical defaults for SETTING.  NB. These are numbers...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>const __LON_DEFAULTS__ = 0;
const __LAT_DEFAULTS__ = 0;
 
</code></pre>
						</td>
					</tr>
					<tr id="section_3">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_3">&#182;</a>
							</div>
							<p>add logical defaults for testing.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
const __DOB_DEFAULTS__ = &quot;00 00 0000&quot;;
const __TOB_DEFAULTS__ = &quot;00 00&quot;;

</code></pre>
						</td>
					</tr>
					<tr id="section_4">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_4">&#182;</a>
							</div>
							<p>an impossibly obscure value.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>const __NUMBER_DEFAULTS__ = Number.MIN_VALUE;
</code></pre>
						</td>
					</tr>
					<tr id="section_5">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_5">&#182;</a>
							</div>
							<p>an unlikely accidental match</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>const __STRING_DEFAULTS__ = &quot;__INIT_ME__&quot;;

</code></pre>
						</td>
					</tr>
					<tr id="section_6">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_6">&#182;</a>
							</div>
							<p>assign defaults</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
var dob = __DOB_DEFAULTS__;
var tob = __TOB_DEFAULTS__;
var lon = __NUMBER_DEFAULTS__;
var lat = __NUMBER_DEFAULTS__;
var acc = __NUMBER_DEFAULTS__;

var command=__STRING_DEFAULTS__;
var datastream=__STRING_DEFAULTS__;
var datacommand=__STRING_DEFAULTS__;
var dataPassed=__STRING_DEFAULTS__;

</code></pre>
						</td>
					</tr>
					<tr id="section_7">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_7">&#182;</a>
							</div>
							<p>add protoype methods for testing.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>String.prototype.IsDefaultTOB = function() {
   return this == __TOB_DEFAULTS__;
};

String.prototype.IsDefaultDOB = function() {
   return this == __DOB_DEFAULTS__;
};

String.prototype.IsDefault = function() {
   return this == __STRING_DEFAULTS__;
};

Number.prototype.IsDefault = function() {
   return this == __NUMBER_DEFAULTS__;
};

var CRLF = &quot;&amp;#013;&amp;#010;&quot;;
var br = &quot;&lt;br /&gt;&quot;;
var originalentries = null;
var recordsList; // = document.getElementById(&#39;person&#39;);

var latsign = 1;
var absdlat = 0;
var absmlat = 0;
var absslat = 0;

var SignNeatTitles = [&quot;Aries&quot;, &quot;Taurus&quot;, &quot;Gemini&quot;, &quot;Cancer&quot;, &quot;Leo&quot;, &quot;Virgo&quot;, &quot;Libra&quot;, &quot;Scorpio&quot;, &quot;Sagittarius&quot;, &quot;Capricon&quot;, &quot;Aquarius&quot;, &quot;Pisces&quot;];
</code></pre>
						</td>
					</tr>
					<tr id="section_8">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_8">&#182;</a>
							</div>
							<h4>Helper Functions</h4>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
var useLookups = 1;
var maphtml = &quot;&quot;;


function 	_f__InitTheFloatingVariables(){
</code></pre>
						</td>
					</tr>
					<tr id="section_9">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_9">&#182;</a>
							</div>
							<p>No longer required under the new testing regime.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	}
	
</code></pre>
						</td>
					</tr>
					<tr id="section_10">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_10">&#182;</a>
							</div>
							<p>Continue on with creating Global methods</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_11">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_11">&#182;</a>
							</div>
							<p>store semi-permanently our options</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SetGlobalOptions(reference) {
	_f__CreateOptionsObject(reference);
	_f__SaveOptionsCookie(reference);
}

</code></pre>
						</td>
					</tr>
					<tr id="section_12">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_12">&#182;</a>
							</div>
							<p>actually store semi-permanently our options</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SaveOptionsCookie(reference)
{
	    Cookies.set(&#39;OptionsObject&#39;, reference, {
        expires: 8364 
    });
}

</code></pre>
						</td>
					</tr>
					<tr id="section_13">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_13">&#182;</a>
							</div>
							<p>store semi-permanently our options with recall of saved options</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__DoCompleteOptionsSaveThenLoadCycle() {
    _f__SetGlobalOptions(OptionsObject);
    _f__GetGlobalOptions(OptionsObject);
}

</code></pre>
						</td>
					</tr>
					<tr id="section_14">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_14">&#182;</a>
							</div>
							<p>recall semi-permanently stored options</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__GetGlobalOptions(reference) {
    reference = Cookies.getJSON(&#39;OptionsObject&#39;);

</code></pre>
						</td>
					</tr>
					<tr id="section_15">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_15">&#182;</a>
							</div>
							<p>if we have a value set from it.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    if (typeof reference === &quot;undefined&quot;) {

        reference = OptionsObject; // defaults
        _f__SetGlobalOptions(reference); // save it back
    }

	/* PrintArray(reference); */
	
    _f__SetWidgetStateFromOptionsObject(reference);

}

</code></pre>
						</td>
					</tr>
					<tr id="section_16">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_16">&#182;</a>
							</div>
							<p>COOKIE SECTION</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_17">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_17">&#182;</a>
							</div>
							<p>coookie consent</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>var cc = {cc: &quot;false&quot;};
var ccToast = &quot;&quot;;

</code></pre>
						</td>
					</tr>
					<tr id="section_18">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_18">&#182;</a>
							</div>
							<p>store semi-permanently our options</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__CheckCcCookieOptions(reference) {
</code></pre>
						</td>
					</tr>
					<tr id="section_19">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_19">&#182;</a>
							</div>
							<p>Check the current cookie...
if it is junk do the required steps to make it appear valid and not break stuff.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>_f__GetCcCookie(cc);

</code></pre>
						</td>
					</tr>
					<tr id="section_20">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_20">&#182;</a>
							</div>
							<p>if we already set a POSITIVE cookie then just return here. It's the shortest possible path.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>

if(cc[&#39;cc&#39;] == &quot;true&quot;   )
return;

</code></pre>
						</td>
					</tr>
					<tr id="section_21">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_21">&#182;</a>
							</div>
							<p>Make some options and attach the callback.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
toastr.clear();

toastr.options = {
  &quot;closeButton&quot;: false,
  &quot;debug&quot;: false,
  &quot;newestOnTop&quot;: false,
  &quot;progressBar&quot;: false,
  &quot;positionClass&quot;: &quot;toast-top-right-cc&quot;,
  &quot;preventDuplicates&quot;: false,
  &quot;showDuration&quot;: &quot;300&quot;,
  &quot;hideDuration&quot;: &quot;1000&quot;,
  &quot;timeOut&quot;: 0,
  &quot;extendedTimeOut&quot;: 0,
  &quot;showEasing&quot;: &quot;swing&quot;,
  &quot;hideEasing&quot;: &quot;linear&quot;,
  &quot;showMethod&quot;: &quot;fadeIn&quot;,
  &quot;hideMethod&quot;: &quot;fadeOut&quot;,
  &quot;tapToDismiss&quot;: false
}

 toastr.options.onclick = _f__CookieCcCallback;

</code></pre>
						</td>
					</tr>
					<tr id="section_22">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_22">&#182;</a>
							</div>
							<p>Okay so we need to show this thing...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>ccToast = toastr[&quot;cc&quot;](&quot;We may place cookies on your computer to store your options. &lt;br/&gt;More details can be found in our privacy policy &amp;nbsp;&lt;button type=&#39;button&#39; class=&#39;clear cc-ok btn clear&#39;&gt;Okay, I get it.&lt;/button&gt;&quot;, &quot;COMPLIANCE&quot;);
	
}

</code></pre>
						</td>
					</tr>
					<tr id="section_23">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_23">&#182;</a>
							</div>
							<p>Event fired on clicking "OK"</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__CookieCcCallback( ){
</code></pre>
						</td>
					</tr>
					<tr id="section_24">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_24">&#182;</a>
							</div>
							<p>debugP("global: CookieCcCallback");</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	ccToast.remove();
	

	
	cc = {cc: &quot;true&quot;};

	_f__SaveCcCookie(cc);
	_f__CheckCcCookieOptions(cc);
	
}

</code></pre>
						</td>
					</tr>
					<tr id="section_25">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_25">&#182;</a>
							</div>
							<p>recall semi-permanently stored options about the cookie consent cookie</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__GetCcCookie(reference) {
    reference = Cookies.getJSON(&#39;cc&#39;);
	
</code></pre>
						</td>
					</tr>
					<tr id="section_26">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_26">&#182;</a>
							</div>
							<p>if we DONT have a valid value.
<br/>MAKE ONE
<br/>Then pretend that we loaded it </p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    if (typeof reference === &quot;undefined&quot;) {
        reference = {cc: &quot;false&quot;}; // defaults
        _f__SaveCcCookie(reference); // save it back
    }
	
	cc = reference;
}

</code></pre>
						</td>
					</tr>
					<tr id="section_27">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_27">&#182;</a>
							</div>
							<p>CALL FROM CONSOLE to restest.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__UndoCc(){
	
	cc = {cc: &quot;false&quot;};
	_f__SaveCcCookie(cc);
	
}

</code></pre>
						</td>
					</tr>
					<tr id="section_28">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_28">&#182;</a>
							</div>
							<p><em>f</em>_SaveCcCookie lets us set a semi permanant cookie for the cc auth</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SaveCcCookie(reference)
{
	    Cookies.set(&#39;cc&#39;, reference, { expires: 2147  });
}

</code></pre>
						</td>
					</tr>
					<tr id="section_29">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_29">&#182;</a>
							</div>
							<p>Vast logic required to tidy up a few boxes of input dynamically.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__LimitCertainKeystrokes(){
	
    $(&#39;#uk-lat,#uk-lat-tar&#39;).focus(function  () {
        oldUkLatValue = $(this).val();
        $(this).val(&#39;&#39;);
    }).blur(function  () {
        if ($(this).val() == &#39;&#39;) {
            $(this).val(oldUkLatValue);
        } else {
            $(this).val($(this).val().replace(/[^\d.-]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
        }

        lat = $(this).val();

    })[0].maxLength = 8;

    $(&#39;#uk-lon,#uk-lon-tar&#39;).focus(function  () {
        oldUkLonValue = $(this).val();
        $(this).val(&#39;&#39;);
    }).blur(function  () {
        if ($(this).val() == &#39;&#39;) {
            $(this).val(oldUkLonValue);
        } else {
            $(this).val($(this).val().replace(/[^\d.-]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
        }

        lon = $(this).val();
    })[0].maxLength = 8;


</code></pre>
						</td>
					</tr>
					<tr id="section_30">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_30">&#182;</a>
							</div>
							<p>OLD MAP LOCATION INIT</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>

   $(&#39;.uk-dob, .uk-dob-tar&#39;).bind(&#39;focus&#39;, function  () {
            if ($(this).val() == &#39;00 00 0000&#39;) {
                $(this).val(&#39;&#39;);
            }
        })
    .on(&#39;paste&#39;, function  () {

        var self = $(this);
        setTimeout(function  () { // Magically replace letters with a space.
            $(self).val($(self).val().replace(/[^\d.-]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
        }, 10);

    }).on(&#39;keyup&#39;, function  () {

        var self = $(this);
        setTimeout(function  () { // Magically replace letters with a space.
            $(self).val($(self).val().replace(/[^\d.-]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
        }, 10);

    });

	
	 $(&#39;.uk-dob-tar&#39;)
        .bind(&#39;blur&#39;, function  () {
            if ($(this).val().trim() == &#39;&#39;) {
                $(this).val(&#39;00 00 0000&#39;);
            }
            $(this).val($(this).val().replace(/[^\d.-]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));

            var ukTobVal = $(&#39;#uk-tob-tar&#39;).val();

            var splitDob = $(this).val().split(&#39; &#39;);
            var splitTob = ukTobVal.split(&#39; &#39;);
            if ($(this).val().trim() != &#39;&#39; &amp;&amp; ukTobVal != &#39;00 00&#39; &amp;&amp; ukTobVal != &#39;&#39;) {
                OptionsObjectDateTime = new Date(splitDob[2], splitDob[1], splitDob[0], splitTob[0], splitTob[1]);
			}
			 $(&#39;#uk-dob-tar&#39;).val($(this).val());
			
        })
		
		
		 $(&#39;.uk-dob&#39;)
        .bind(&#39;blur&#39;, function  () {
            if ($(this).val().trim() == &#39;&#39;) {
                $(this).val(&#39;00 00 0000&#39;);
            }
            $(this).val($(this).val().replace(/[^\d.-]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));

            var ukTobVal = $(&#39;#uk-tob&#39;).val();

            var splitDob = $(this).val().split(&#39; &#39;);
            var splitTob = ukTobVal.split(&#39; &#39;);


            if ($(this).val().trim() != &#39;&#39; &amp;&amp; ukTobVal != &#39;00 00&#39; &amp;&amp; ukTobVal != &#39;&#39;) {
                OptionsObjectDateTime = new Date(splitDob[2], splitDob[1], splitDob[0], splitTob[0], splitTob[1]);	}
				
				
			 $(&#39;#uk-dob&#39;).val($(this).val());
				
     })
	
	
	
    $(&#39;.uk-tob, .uk-tob-tar&#39;).bind(&#39;focus&#39;, function  () {
            if ($(this).val() == &#39;00 00&#39;) {
                $(this).val(&#39;&#39;);
            }
        })
        .on(&#39;paste&#39;, function  () {
            var self = $(this);
            setTimeout(function  () { // Magically replace letters with a space.
                $(self).val($(self).val().replace(/[^\d.]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
            }, 10);

        }).on(&#39;keyup&#39;, function  () {

            var self = $(this);
            setTimeout(function  () { // Magically replace letters with a space.
                $(self).val($(self).val().replace(/[^\d.]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
            }, 10);

        });

		 $(&#39;.uk-tob-tar&#39;)
        .bind(&#39;blur&#39;, function  () {
            if ($(this).val().trim() == &#39;&#39;) {
                $(this).val(&#39;00 00&#39;);
            }
            $(this).val($(this).val().replace(/[^\d.]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));


            var ukDobVal = $(&#39;#uk-dob-tar&#39;).val();

            var splitTob = $(this).val().split(&#39; &#39;);
            var splitDob = ukDobVal.split(&#39; &#39;);


            if ($(this).val().trim() != &#39;&#39; &amp;&amp; ukDobVal != &#39;00 00 00&#39; &amp;&amp; ukDobVal != &#39;&#39;) {
                OptionsObjectDateTime = new Date(splitDob[2], splitDob[1], splitDob[0], splitTob[0], splitTob[1]);
            }


            if ($(this).val().trim() != &#39;&#39;) {
                OptionsObjectDateTime = $(this).val();
            }
			
			$(&#39;#uk-tob-tar&#39;).val($(this).val());
			
        })
		
		$(&#39;.uk-tob&#39;)
        .bind(&#39;blur&#39;, function  () {
            if ($(this).val().trim() == &#39;&#39;) {
                $(this).val(&#39;00 00&#39;);
            }
            $(this).val($(this).val().replace(/[^\d.]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
            var ukDobVal = $(&#39;#uk-dob&#39;).val();
            var splitTob = $(this).val().split(&#39; &#39;);
            var splitDob = ukDobVal.split(&#39; &#39;);
            if ($(this).val().trim() != &#39;&#39; &amp;&amp; ukDobVal != &#39;00 00 00&#39; &amp;&amp; ukDobVal != &#39;&#39;) {
                OptionsObjectDateTime = new Date(splitDob[2], splitDob[1], splitDob[0], splitTob[0], splitTob[1]);
            }
            if ($(this).val().trim() != &#39;&#39;) {
                OptionsObjectDateTime = $(this).val();
            }
			$(&#39;#uk-tob&#39;).val($(this).val());
			
        })
		
		
		
    /*} */
	
}


</code></pre>
						</td>
					</tr>
					<tr id="section_31">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_31">&#182;</a>
							</div>
							<p>Link together all the logic ready for the first run </p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__InitPage() {
</code></pre>
						</td>
					</tr>
					<tr id="section_32">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_32">&#182;</a>
							</div>
							<p>for when we reintroduce the map logic</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    useLookups = 1;
  
  new Clipboard(&#39;.copy-btn&#39;);
  
  	var fileInput = document.getElementById(&#39;fileInput&#39;);
		var fileDisplayArea = document.getElementById(&#39;fileDisplayArea&#39;);

		
</code></pre>
						</td>
					</tr>
					<tr id="section_33">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_33">&#182;</a>
							</div>
							<p>Here we do our imports.
TODO: ADD HEALTH CHECKS FOR IMPORTED FILES</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>  fileInput.addEventListener(&#39;change&#39;, function(e) {
			var file = fileInput.files[0];
			var textType = /text.*/;

			if (file.type.match(textType)) {
				var reader = new FileReader();

				reader.onload = function(e) {
					
				_f__handle_return(reader.result);
</code></pre>
						</td>
					</tr>
					<tr id="section_34">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_34">&#182;</a>
							</div>
							<p>fileDisplayArea.innerHTML  = reader.result;</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>				
				
				}

				reader.readAsText(file);	
				
			} else {
				fileDisplayArea.innerHTML  = &quot;File not supported!&quot;;
			}
		});

  
	_f__GetGlobalOptions(OptionsObject);
  
</code></pre>
						</td>
					</tr>
					<tr id="section_35">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_35">&#182;</a>
							</div>
							<p>Here we PHYSICALLY BUILD the options buttons.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__buildOptions();

</code></pre>
						</td>
					</tr>
					<tr id="section_36">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_36">&#182;</a>
							</div>
							<p>now we embed that into a dialog box :)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	    $( &quot;#optionsHolder&quot; ).dialog({
      autoOpen: false,
	   width: 180,
	   minWidth: 180,
		height: 660,
		minHeight: 660,
		 modal: false,
		 resizable:true,
		 title: &quot;Options&quot;,
		dialogClass: &quot;optionsHolder&quot;,
		position:{my: &quot;left bottom&quot;,at: &quot;right top&quot;,of: &quot;#logo&quot;},
      show: {
        effect: &quot;blind&quot;,
        duration: 300
      },
      hide: {
        effect: &quot;blind&quot;,
        duration: 300
      }
	  
    });
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_37">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_37">&#182;</a>
							</div>
							<p>we will IDEALLY in the end be able to resize this box AFTER the charts have rendered.
TODO THIS NEEDS DOING...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	 
</code></pre>
						</td>
					</tr>
					<tr id="section_38">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_38">&#182;</a>
							</div>
							<p>now we embed that into a dialog box :)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	    $( &quot;#chartsHolder&quot; ).dialog({
      autoOpen: false,
	   width: 400,
	   minWidth: 400,
		height: 720,
		minHeight: 720,
		 modal: false,
		 resizable:true,
		 title: &quot;Charts&quot;,
		dialogClass: &quot;chartsHolder&quot;,
		position:{my: &quot;left bottom&quot;,at: &quot;right top&quot;,of: &quot;#logo&quot;},
      show: {
        effect: &quot;blind&quot;,
        duration: 300
      },
      hide: {
        effect: &quot;blind&quot;,
        duration: 300
      },
	  buttons: {
        &quot;Report&quot;: function() {
        _f__flagP( lastFullChartReport);
        },
        &quot;Close&quot;: function() {
          $( this ).dialog( &quot;close&quot; );
        }
	  }
	  
    });
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_39">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_39">&#182;</a>
							</div>
							<p>now we embed that into a dialog box :)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	    $( &quot;#xchartsHolder&quot; ).dialog({
      autoOpen: false,
	   width: 400,
	   minWidth: 400,
        height: 630,
		minHeight: 610,
		 modal: false,
		 resizable:true,
		 title: &quot;xProfile Charts&quot;,
		dialogClass: &quot;xchartsHolder&quot;,
		position:{my: &quot;left bottom&quot;,at: &quot;right top&quot;,of: &quot;#logo&quot;},
      show: {
        effect: &quot;blind&quot;,
        duration: 300
      },
      hide: {
        effect: &quot;blind&quot;,
        duration: 300
      },
	  buttons: {
        &quot;Report&quot;: function() {
        _f__flagP( lastFullChartReport);
        },
        &quot;Close&quot;: function() {
          $( this ).dialog( &quot;close&quot; );
        }
	  }
	  
    });
	
</code></pre>
						</td>
					</tr>
					<tr id="section_40">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_40">&#182;</a>
							</div>
							<p>we will IDEALLY in the end be able to resize this box AFTER the charts have rendered.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
</code></pre>
						</td>
					</tr>
					<tr id="section_41">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_41">&#182;</a>
							</div>
							<p>now we embed that into a dialog box :)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	    $( &quot;#exporterHolder&quot; ).dialog({
      autoOpen: false,
	   width: 400,
	   minWidth: 400,
        height: 200,
		minHeight: 200,
		modal: false,
		 resizable:false,
		 title: &quot;EXPORT / IMPORT&quot;,
		dialogClass: &quot;exporterHolder&quot;,
		position:{my: &quot;left bottom&quot;,at: &quot;right top&quot;,of: &quot;#logo&quot;},
      show: {
        effect: &quot;blind&quot;,
        duration: 300
      },
      hide: {
        effect: &quot;blind&quot;,
        duration: 300
      }
	/*   ,
	  buttons: {
        &quot;Save Current Selection&quot;: function() {
			
</code></pre>
						</td>
					</tr>
					<tr id="section_42">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_42">&#182;</a>
							</div>
							<p>rememeber to create this</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			
        SaveCurrentSelection();
        },
        &quot;Close&quot;: function() {
          $( this ).dialog( &quot;close&quot; );
        }
	  } */
	  
    });
	
</code></pre>
						</td>
					</tr>
					<tr id="section_43">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_43">&#182;</a>
							</div>
							<p><em>f</em>_BindKeys Link the hidden key bindings for the devs</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__BindKeys();
</code></pre>
						</td>
					</tr>
					<tr id="section_44">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_44">&#182;</a>
							</div>
							<p><em>f</em>_InitCharts Make the charts stuff be ready to print us some</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__InitCharts();
</code></pre>
						</td>
					</tr>
					<tr id="section_45">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_45">&#182;</a>
							</div>
							<p><em>f</em>_InitChartsAdd the actual boxes in the page that allow us the enter data</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__AppendRecordHTML();
</code></pre>
						</td>
					</tr>
					<tr id="section_46">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_46">&#182;</a>
							</div>
							<p>Put something in the RIGHT HAND SIDE record LIST from stored data</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__populateRecordsList();
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_47">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_47">&#182;</a>
							</div>
							<p>Put something in our hidden selections listings.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	_f__populateSelectionsList();
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_48">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_48">&#182;</a>
							</div>
							<p>Enable the RIGHT HAND SIDE record LIST to filter based on keystrokes</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__InitSearching();
	
</code></pre>
						</td>
					</tr>
					<tr id="section_49">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_49">&#182;</a>
							</div>
							<p>Put something in the current VIRTUAL copy of the Positions and themes
Possibly just defaults. Maybe Lookup data.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__populateValueArraysFromScreenValues();
	
</code></pre>
						</td>
					</tr>
					<tr id="section_50">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_50">&#182;</a>
							</div>
							<p>Convert that data to stuff in the POSITION ENTRY boxes (via the hidden decimal boxes). </p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__populateHMSArraysFromValueArraysValues();
	

	
</code></pre>
						</td>
					</tr>
					<tr id="section_51">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_51">&#182;</a>
							</div>
							<p>Enable the user to easily tab between boxes.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__AutoSetupTheTabbingOrder();

</code></pre>
						</td>
					</tr>
					<tr id="section_52">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_52">&#182;</a>
							</div>
							<p>additional possible methods for popups</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	 /*        $(&#39;#clearlasttoast&#39;).click(function  () {
            toastr.clear(getLastToast());
        }); */
	
</code></pre>
						</td>
					</tr>
					<tr id="section_53">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_53">&#182;</a>
							</div>
							<p>make the big hidden button clear stuff.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        $(&#39;#cleartoasts&#39;).click(function  () {
			
</code></pre>
						</td>
					</tr>
					<tr id="section_54">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_54">&#182;</a>
							</div>
							<p>TODO: Fix this rubbish function. by using a [] that we walk over and  .remove() ourselves.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>            toastr.clear();
			$(this).blur();
        });

	
</code></pre>
						</td>
					</tr>
					<tr id="section_55">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_55">&#182;</a>
							</div>
							<p>The currently elided map lookup feature.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'> 
     if ( typeof(dataPassed) === &quot;undefined&quot;  )
     {
    	 useLookups = 0; 
     warnP(&quot;HTML used directly. perl not detected. Map features hidden&quot;); 
</code></pre>
						</td>
					</tr>
					<tr id="section_56">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_56">&#182;</a>
							</div>
							<p>$('.requiresOnline').hide();</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>

     }
    else
    {

    var maphtml=&quot;&lt;div class=&#39;modal-dialog&#39; style=&#39;background-color: rgb(202, 222, 230);&#39;&gt; &lt;div class=&#39;modal-content&#39; style=&#39;background-color: rgb(202, 222, 230);&#39;&gt; &lt;div class=&#39;modal-header&#39; style=&#39;background-color: rgb(202, 222, 230);&#39;&gt; &lt;button type=&#39;button&#39; class=&#39;close&#39; data-dismiss=&#39;modal&#39; aria-label=&#39;Close&#39;&gt;&lt;span aria-hidden=&#39;true&#39;&gt;&amp;times;&lt;/span&gt;&lt;/button&gt; &lt;h4 class=&#39;modal-title&#39;&gt;Enter Your Birth Details&lt;/h4&gt; &lt;/div&gt; &lt;div class=&#39;detailsForm&#39; style=&#39;pointer-events: none; height: 130px; margin-top: 10px;&#39; &gt; &lt;form id=&#39;f2&#39; style=&#39;width:500px;&#39; name=&#39;f2&#39; class=&#39;m-t-small&#39; action=&#39;index.pl&#39; method=&#39;get&#39;&gt; &lt;div class=&#39;entry-holder&#39; &gt; &lt;span style=&#39;white-space:nowrap;&#39;&gt; &lt;label for=&#39;uk-dob-map&#39; class=&#39;p-r-small col-sm-1 control-label defaultedValueDob&#39; &gt;D.O.B&lt;/label&gt; &lt;input type=&#39;text&#39; title=&#39;Enter the Day, Month and year separated by spaces&#39; class=&#39;form-control clickable uk-dob&#39; style=&#39;width: 110px; margin-left: 30px; float: left;&#39; id=&#39;uk-dob-map&#39; name=&#39;dob-map&#39; value=&#39;00 00 0000&#39; /&gt; &lt;label for=&#39;uk-tob-map&#39; class=&#39;p-r-small col-sm-2 control-label defaultedValueTob &#39;&gt;Time OB. (If known)&lt;/label&gt; &lt;input type=&#39;text&#39; class=&#39;form-control clickable uk-tob&#39; title=&#39;Enter the Hour and minute separated by a space&#39; style=&#39;width: 110px; margin-left: 80px; float: left;&#39; id=&#39;uk-tob-map&#39; name=&#39;tob&#39; value=&#39;00 00&#39; /&gt;&lt;/span&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;div class=&#39;modal-body requiresOnline&#39; style=&#39;margin-top: -50px;&#39;&gt; &lt;div class=&#39;form-horizontal&#39; style=&#39;width: 550px&#39;&gt; &lt;div class=&#39;form-group&#39;&gt; &lt;label for=&#39;uk-address&#39; style=&#39;margin-left: -8px; margin-top: -50px;&#39; class=&#39;col-sm-2 control-label&#39;&gt;Location:&lt;/label&gt; &lt;div class=&#39;col-sm-10&#39;&gt;&lt;input style=&#39;margin-left: 80px; margin-top: -50px;&#39; type=&#39;text&#39; class=&#39;form-control&#39; id=&#39;uk-address&#39;/&gt;&lt;/div&gt; &lt;/div&gt; &lt;div id=&#39;uk-picker&#39; style=&#39;width: 100%; height: 250px; margin-bottom:0px; &#39;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&#39;modal-footer&#39;&gt; &lt;button type=&#39;button&#39; data-dismiss=&#39;modal&#39; class=&#39;btn btn-primary requiresOnline&#39; id=&#39;SaveChanges&#39; &gt;Save Changes + Get natal chart positions&lt;/button&gt;  &lt;button type=&#39;button&#39; class=&#39;btn btn-default&#39; data-dismiss=&#39;modal&#39;&gt;Close&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&quot;;

	
	var maphtmltar=&quot; &lt;div class=&#39;modal-dialog&#39; style=&#39;background-color: rgb(202, 222, 230);&#39;&gt; &lt;div class=&#39;modal-content&#39; style=&#39;background-color: rgb(202, 222, 230);&#39;&gt; &lt;div class=&#39;modal-header&#39; style=&#39;background-color: rgb(202, 222, 230);&#39;&gt; &lt;button type=&#39;button&#39; class=&#39;close&#39; data-dismiss=&#39;modal&#39; aria-label=&#39;Close&#39;&gt;&lt;span aria-hidden=&#39;true&#39;&gt;&amp;times;&lt;/span&gt;&lt;/button&gt; &lt;h4 class=&#39;modal-title&#39;&gt;Enter Your Birth Details&lt;/h4&gt; &lt;/div&gt; &lt;div class=&#39;detailsForm&#39; style=&#39;pointer-events: none; height: 130px; margin-top: 10px;&#39; &gt; &lt;form id=&#39;f3&#39; style=&#39;width:500px;&#39; name=&#39;f3&#39; class=&#39;m-t-small&#39; action=&#39;index.pl&#39; method=&#39;get&#39;&gt; &lt;div class=&#39;entry-holder-tar&#39; &gt; &lt;span style=&#39;white-space:nowrap;&#39;&gt; &lt;label for=&#39;uk-dob-tar&#39; class=&#39;p-r-small col-sm-1 control-label defaultedValueDob&#39; &gt;D.O.B&lt;/label&gt; &lt;input type=&#39;text&#39; title=&#39;Enter the Day, Month and year separated by spaces&#39; class=&#39;form-control clickable uk-dob-tar&#39; style=&#39;width: 110px; margin-left: 30px; float: left;&#39; id=&#39;uk-dob-tar&#39; name=&#39;dob-tar&#39; value=&#39;00 00 0000&#39; /&gt; &lt;label for=&#39;uk-tob-tar&#39; class=&#39;p-r-small col-sm-2 control-label defaultedValueTob &#39;&gt;Time OB. (If known)&lt;/label&gt; &lt;input type=&#39;text&#39; class=&#39;form-control clickable uk-tob-tar&#39; title=&#39;Enter the Hour and minute separated by a space&#39; style=&#39;width: 110px; margin-left: 80px; float: left;&#39; id=&#39;uk-tob-tar&#39; name=&#39;tob-tar&#39; value=&#39;00 00&#39; /&gt;&lt;/span&gt; &lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;div class=&#39;modal-body requiresOnline&#39; style=&#39;margin-top: -50px;&#39;&gt; &lt;div class=&#39;form-horizontal&#39; style=&#39;width: 550px&#39;&gt; &lt;div class=&#39;form-group&#39;&gt; &lt;label for=&#39;uk-address-tar&#39; style=&#39;margin-left: -8px; margin-top: -50px;&#39; class=&#39;col-sm-2 control-label&#39;&gt;Location:&lt;/label&gt; &lt;div class=&#39;col-sm-10&#39;&gt;&lt;input style=&#39;margin-left: 80px; margin-top: -50px;&#39; type=&#39;text&#39; class=&#39;form-control&#39; id=&#39;uk-address-tar&#39;/&gt;&lt;/div&gt; &lt;/div&gt; &lt;div id=&#39;uk-picker-tar&#39; style=&#39;width: 100%; height: 250px; margin-bottom:0px; &#39;&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=&#39;modal-footer&#39;&gt; &lt;button type=&#39;button&#39; data-dismiss=&#39;modal&#39; class=&#39;btn btn-primary requiresOnline&#39; id=&#39;SaveChangesTar&#39; &gt;Save Changes + Get natal chart positions&lt;/button&gt;  &lt;button type=&#39;button&#39; class=&#39;btn btn-default&#39; data-dismiss=&#39;modal&#39;&gt;Close&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt;&quot;;
	
	
	
	


    	$(&#39;#uk-dialog&#39;).html(maphtml);
		
		$(&#39;#uk-dialog-tar&#39;).html(maphtmltar);
		
	}
	
	/* Assign the click  */
	$(&#39;#SaveChangesTar&#39;).on(&#39;click&#39;, function(){
		 _f__SaveChangesGetChart(&quot;target&quot;);
	}    );
	
	/* Assign the click  */	
	$(&#39;#SaveChanges&#39;).on(&#39;click&#39;, function(){
		 _f__SaveChangesGetChart(&quot;subject&quot;);
	}    );
	
	
	/* var latTemp = $(&#39;#uk-lat&#39;).prop(&#39;value&#39;);
	var lonTemp =  $(&#39;#uk-lon&#39;).prop(&#39;value&#39;);
	var tobTemp =  $(&#39;#uk-dob&#39;).prop(&#39;value&#39;);
	var dobTemp =  $(&#39;#uk-tob&#39;).prop(&#39;value&#39;); */
	
	
		var currentLat = $(&#39;#uk-lat&#39;).prop(&#39;value&#39;);
		var currentLon = $(&#39;#uk-lon&#39;).prop(&#39;value&#39;);
		var currentDob = $(&#39;#uk-dob&#39;).prop(&#39;value&#39;);
		var currentTob = $(&#39;#uk-tob&#39;).prop(&#39;value&#39;);
		
		
		  $(&#39;#uk-picker&#39;).locationpicker({
                                location: {latitude: currentLat, longitude: currentLon},
    							radius: 0,
                                inputBinding: {
                                    latitudeInput: $(&#39;#uk-lat&#39;),
                                    longitudeInput: $(&#39;#uk-lon&#39;),
                                    locationNameInput: $(&#39;#uk-address&#39;)
                                },
    							enableAutocomplete: true,
    							onchanged: function  (currentLocation) {
    								
    							$(&#39;#uk-lat&#39;).prop(&#39;value&#39;, currentLocation.latitude.toString().substring(0,8)  );
    							$(&#39;#uk-lon&#39;).prop(&#39;value&#39;, currentLocation.longitude.toString().substring(0,8)  );
    								
    									$(&#39;#uk-lat&#39;)[0].maxLength = 6;
    									$(&#39;#uk-lon&#39;)[0].maxLength = 6;
    								
</code></pre>
						</td>
					</tr>
					<tr id="section_57">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_57">&#182;</a>
							</div>
							<p>debugP("Location changed. New location (" + currentLocation.latitude + ", " + currentLocation.longitude + ")");</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                            }
    						});
                            $(&#39;#uk-dialog&#39;).on(&#39;shown.bs.modal&#39;, function() {
								
								var currentLat = $(&#39;#uk-lat&#39;).prop(&#39;value&#39;);
								var currentLon = $(&#39;#uk-lon&#39;).prop(&#39;value&#39;)
								var currentDob = $(&#39;#uk-dob&#39;).prop(&#39;value&#39;);
								var currentTob = $(&#39;#uk-tob&#39;).prop(&#39;value&#39;);
								
								$(&#39;.uk-dob&#39;).prop(&#39;value&#39;, currentDob);
								$(&#39;.uk-tob&#39;).prop(&#39;value&#39;, currentTob);
								
								$(&#39;#uk-picker&#39;).locationpicker(&#39;location&#39;, {latitude: currentLat, longitude: currentLon}    );
								
								
								$(&#39;#uk-picker&#39;).locationpicker(&#39;autosize&#39;);
								
								
                            });	
    	
    	
		/*  Do the Target one  */
		
		var currentLat = $(&#39;#uk-lat-tar&#39;).prop(&#39;value&#39;);
		var currentLon = $(&#39;#uk-lon-tar&#39;).prop(&#39;value&#39;);
		var currentDob = $(&#39;#uk-dob-tar&#39;).prop(&#39;value&#39;);
		var currentTob = $(&#39;#uk-tob-tar&#39;).prop(&#39;value&#39;);
		
		
		  $(&#39;#uk-picker-tar&#39;).locationpicker({
                                location: {latitude: currentLat, longitude: currentLon},
    							radius: 0,
                                inputBinding: {
                                    latitudeInput: $(&#39;#uk-lat-tar&#39;),
                                    longitudeInput: $(&#39;#uk-lon-tar&#39;),
                                    locationNameInput: $(&#39;#uk-address-tar&#39;)
                                },
    							enableAutocomplete: true,
    							onchanged: function  (currentLocation) {
    								
    							$(&#39;#uk-lat-tar&#39;).prop(&#39;value&#39;, currentLocation.latitude.toString().substring(0,8)  );
    							$(&#39;#uk-lon-tar&#39;).prop(&#39;value&#39;, currentLocation.longitude.toString().substring(0,8)  );
    								
    									$(&#39;#uk-lat-tar&#39;)[0].maxLength = 6;
    									$(&#39;#uk-lon-tar&#39;)[0].maxLength = 6;
    								
</code></pre>
						</td>
					</tr>
					<tr id="section_58">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_58">&#182;</a>
							</div>
							<pre><code>debugP("Location changed. New location (" + currentLocation.latitude + ", " + currentLocation.longitude + ")");
</code></pre>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                            }
    						});
                            $(&#39;#uk-dialog-tar&#39;).on(&#39;shown.bs.modal&#39;, function() {
								
								var currentLat = $(&#39;#uk-lat-tar&#39;).prop(&#39;value&#39;);
								var currentLon = $(&#39;#uk-lon-tar&#39;).prop(&#39;value&#39;)
								var currentDob = $(&#39;#uk-dob-tar&#39;).prop(&#39;value&#39;);
								var currentTob = $(&#39;#uk-tob-tar&#39;).prop(&#39;value&#39;);
								
								$(&#39;.uk-dob-tar&#39;).prop(&#39;value&#39;, currentDob);
								$(&#39;.uk-tob-tar&#39;).prop(&#39;value&#39;, currentTob);
								
								$(&#39;#uk-picker-tar&#39;).locationpicker(&#39;location&#39;, {latitude: currentLat, longitude: currentLon}    );
								
								
								$(&#39;#uk-picker-tar&#39;).locationpicker(&#39;autosize&#39;);
								
								
                            });	
    	
		
		

	
	
	   $(&#39;.hmsInputTypes, .bgTypes, .clearForm, .precessionFlag&#39;).selectmenu();
    $(&#39;.hmsInputTypes , .bgTypes, .clearForm, .precessionFlag&#39;).next().addClass(&quot;hmsInputTypesExtra&quot;);
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_59">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_59">&#182;</a>
							</div>
							<p>Prevent the typing of stupid characters. Mangle stupid input into good input.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	_f__LimitCertainKeystrokes();
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_60">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_60">&#182;</a>
							</div>
							<p>this allows us to bind events to the highly aloof JqueryUI select widget. Bleugh</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	$(function() {
             $( &quot;.SignPrefix&quot; ).selectmenu({
                 change: function( event, ui ) {
</code></pre>
						</td>
					</tr>
					<tr id="section_61">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_61">&#182;</a>
							</div>
							<p>console.log(ui);</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>                     var selected_value = ui.item.value;
					 
					 var TLA = SignNeatTitles[selected_value / 30];
					 
					 var theSignValueBox = $(this).next().next().next().next();
					
					theSignValueBox.prop(&#39;title&#39;, TLA);
					theSignValueBox.html(TLA.slice(0,3));
						
					theSignValueBox.removeClass(&quot;unset-sign&quot;);	
				
                 }
             });
        });
	
	
</code></pre>
						</td>
					</tr>
					<tr id="section_62">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_62">&#182;</a>
							</div>
							<p>now we embed that into a dialog box :)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	    $( &quot;#selectionsHolder&quot; ).dialog({
      autoOpen: false,
	   width: 280,
	   minWidth: 280,
        height: 700,
		minHeight: 700,
		 modal: false,
		 resizable:true,
		 title: &quot;Selections&quot;,
		dialogClass: &quot;selectionsHolder&quot;,
		position:{my: &quot;left bottom&quot;,at: &quot;right top&quot;,of: &quot;#logo&quot;},
      show: {
        effect: &quot;blind&quot;,
        duration: 300
      },
      hide: {
        effect: &quot;blind&quot;,
        duration: 300
      },
	  buttons: {
       /*  &quot;Save Current Selection&quot;: function() {
			
</code></pre>
						</td>
					</tr>
					<tr id="section_63">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_63">&#182;</a>
							</div>
							<p>rememeber to create this</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			
        SaveCurrentSelection();
        }, */
        &quot;Close&quot;: function() {
          $( this ).dialog( &quot;close&quot; );
        }
	  }
	  
    });
	
	
	$(&#39;#selection_name&#39;).keyup(function(){
	
	if (typeof $(this).val() === &quot;undefined&quot;)
		return;
		
   var valThis = $(this).val().toLowerCase();
    if(valThis == &quot;&quot;){
        $(&#39;#selections &gt; li&#39;).show();           
    } else {
        $(&#39;#selections &gt; li&#39;).each(function(){
            var text = $(this).text().toLowerCase();
            (text.indexOf(valThis) &gt;= 0) ? $(this).show() : $(this).hide();
        });
   };
   }).focus(function(){
	   
	   
	   $(this).val(&#39;&#39;); 
	   
	   
   }   )
  
   ;
	
	
/* 		//this allows us to bind events to the highly aloof JqueryUI select widget. Bleugh
	$(function() {
             $( &quot;#selections&quot; ).selectmenu({
				 width: 360,
				 height: 400,
				 
                 change: function( event, ui ) {
</code></pre>
						</td>
					</tr>
					<tr id="section_64">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_64">&#182;</a>
							</div>
							<p>console.log(ui);</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>					 
					 LoadChosenSelection(ui.item.value);

                 }
             });
        });
	 */
	

</code></pre>
						</td>
					</tr>
					<tr id="section_65">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_65">&#182;</a>
							</div>
							<p>focus is more accessible than click
a user can't change a field without it
more chaining = less searching</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_66">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_66">&#182;</a>
							</div>
							<p>Do some additional wangle to the HMS INPUTS to ensure sane input.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    $(&#39;.hmsbox&#39;) //leave submit buttons, records area, etc alone
        .bind(&#39;focus&#39;, function  () {
            if ($(this).val() == &quot;0 0 0&quot;) {
                $(this).val(&#39;&#39;);
            };
            $(this).addClass(&#39;greened&#39;);
        }) //more chaining = less searching
        .bind(&#39;blur&#39;, function  () {
            _f__ConvertHMSToDecimal(this); /*  supposing you want to revert back on blur...*/
            $(this).removeClass(&#39;greened&#39;);
        }) 
		.bind(&#39;keyup&#39;, function  () {

            $(this).val($(this).val().replace(/[^\d.]/g, &#39; &#39;).replace(/ +/g, &#39; &#39;).replace(/^ +/, &#39;&#39;).replace(/^ /, &#39;&#39;));
			if ($(this).val() == &#39;&#39;)
			{	$(this).next().next().addClass(&quot;unset-sign&quot;);}
			_f__ConvertHMSToDecimal(this);
        
		});

	
</code></pre>
						</td>
					</tr>
					<tr id="section_67">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_67">&#182;</a>
							</div>
							<p>REALLY make sure they are gone</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    _f__clearCharts();

</code></pre>
						</td>
					</tr>
					<tr id="section_68">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_68">&#182;</a>
							</div>
							<p>Link up our submit button to our lookup function</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    $(&quot;#submit_btn&quot;).on(&quot;click&quot;, function(){ _f__SaveChangesGetChart(&quot;subject&quot;)});
	$(&quot;#submit_btn-tar&quot;).on(&quot;click&quot;, function() { _f__SaveChangesGetChart(&quot;target&quot;)});
</code></pre>
						</td>
					</tr>
					<tr id="section_69">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_69">&#182;</a>
							</div>
							<p>Do our due diligence.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	_f__CheckCcCookieOptions(cc);
	
</code></pre>
						</td>
					</tr>
					<tr id="section_70">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_70">&#182;</a>
							</div>
							<p>DECIDE WHICH MODE TO START IN  = triggering this leaves us in xProfile mode. Elide to not.
<em>f</em>_TogglexProfile();</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
		$(&#39;.recordTitle&#39;).html(&#39;Activate xProfile mode&#39;);	
	
	
/* if( ! $(&#39;.xprofile-image&#39;).first().is(&quot;:visible&quot;)   )
	{
		$(&#39;.recordTitle&#39;).html(&#39;Activate chart mode&#39;);	
	}
	else
	{
		
		
	} */

function _f__SetupDefaultsAndClearDowns(valueToSet, thingToClear){
	
	$(&#39;#&#39;+thingToClear).val(valueToSet);
}
	
	
	_f__SetupDefaultsAndClearDowns(&#39;SubjectName&#39;, &#39;Subject&#39;);
_f__SetupDefaultsAndClearDowns(&#39;TargetName&#39;, &#39;Target&#39;);
_f__SetupDefaultsAndClearDowns(&#39;uk-lat&#39;, &#39;0&#39;);
_f__SetupDefaultsAndClearDowns(&#39;uk-lon&#39;, &#39;0&#39;);
_f__SetupDefaultsAndClearDowns(&#39;uk-lat-tar&#39;, &#39;0&#39;);
_f__SetupDefaultsAndClearDowns(&#39;uk-lon-tar&#39;, &#39;0&#39;);

}
</code></pre>
						</td>
					</tr>
					<tr id="section_71">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_71">&#182;</a>
							</div>
							<p>Set the visual form values indirectly via the passed data from perl</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__populateBoxesFromDatastream(NameOfColumn) {
var IsSubjectSave = false;

if (NameOfColumn == &quot;subject&quot;) {
	 IsSubjectSave = true;
 
	 }

</code></pre>
						</td>
					</tr>
					<tr id="section_72">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_72">&#182;</a>
							</div>
							<p>work out which node to use first.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>var activeLonNode = &quot;&quot;;
var activeLatNode = &quot;&quot;;
var activeDobNode = &quot;&quot;;	
var activeTobNode = &quot;&quot;;	
var activeAccNode = &quot;&quot;;
var activeNameNode = &quot;&quot;;

		if (IsSubjectSave)
	 {
		activeLonNode = $(&#39;#uk-lon&#39;);
		activeLatNode =$(&#39;#uk-lat&#39;);
		activeDobNode = $(&#39;#uk-dob&#39;);
		activeTobNode =$(&#39;#uk-tob&#39;);
		activeAccNode =$(&#39;#uk-acc&#39;);
		activeNameNode =  $(&#39;#SubjectName&#39;);
	 }
	else	
	{
		activeLonNode = $(&#39;#uk-lon-tar&#39;);
		activeLatNode =$(&#39;#uk-lat-tar&#39;);
		activeDobNode =$(&#39;#uk-dob-tar&#39;);
		activeTobNode =$(&#39;#uk-tob-tar&#39;);
		activeAccNode =$(&#39;#uk-acc-tar&#39;);
		activeNameNode =  $(&#39;#TargetName&#39;);
	}	
	

</code></pre>
						</td>
					</tr>
					<tr id="section_73">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_73">&#182;</a>
							</div>
							<p>Use starmatch's String.prototype.IsDefault test against the <strong>STRING_DEFAULTS</strong> const...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	if (!datastream.IsDefault()){
	
        var passedData = datastream.split(&#39;&#172;&#39;);
        var boxes = $(&#39;.numVals-&#39;+NameOfColumn);
        var simpleLocalIndex = 0;

</code></pre>
						</td>
					</tr>
					<tr id="section_74">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_74">&#182;</a>
							</div>
							<p><em>f</em>_infoP(passedData + " " + CRLF, 6000);</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
        jQuery.each(passedData, function  (key, index) {
	    if ( key &lt; 10 || key == 25 || key == 26 ) {	// Sun -&gt; Pluto, Asc., MC
                var splitted = index.split(&#39;,&#39;);
</code></pre>
						</td>
					</tr>
					<tr id="section_75">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_75">&#182;</a>
							</div>
							<p>Lets populate the boxes now...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
                boxes[simpleLocalIndex].value = (splitted[1]);

                _f__ConvertDecimalToHMSSingle(boxes[simpleLocalIndex]);

                simpleLocalIndex++;
            }

        });

</code></pre>
						</td>
					</tr>
					<tr id="section_76">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_76">&#182;</a>
							</div>
							<p>use starmatch's protoype IsDefault() tests against the <strong>NUMBER_DEFAULTS</strong> const...
correct for swapped values (focus function problem?)</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        if (!lon.IsDefault())
            activeLonNode.val(lat);
        if (!lat.IsDefault())
            activeLatNode.val(lon);
/*       
	   	$(&#39;#uk-dob&#39;).val(dob.replace(&#39;-&#39;,&#39; &#39;).replace(&#39;-&#39;,&#39; &#39;));
       	$(&#39;#uk-tob&#39;).val(tob.replace(&#39;:&#39;,&#39; &#39;));
*/

</code></pre>
						</td>
					</tr>
					<tr id="section_77">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_77">&#182;</a>
							</div>
							<p>We finished processing records into the SUBJECT recordset fields.
Let's add a helpful reminder message.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
        _f__warnP(&quot;Remember to rename and save your new record&quot;);

    }

    $(&#39;.error&#39;).hide();

</code></pre>
						</td>
					</tr>
					<tr id="section_78">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_78">&#182;</a>
							</div>
							<p>Move the focus to this element and make the relevant column name blank.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
  activeNameNode.val(&#39;&#39;).focus();


}

</code></pre>
						</td>
					</tr>
					<tr id="section_79">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_79">&#182;</a>
							</div>
							<p>Make the OptionsObject be the current widget values</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SetOptionsObjectFromWidgetState(){
	var hasError = 0;
</code></pre>
						</td>
					</tr>
					<tr id="section_80">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_80">&#182;</a>
							</div>
							<p>Magically divine the chosen options based on witchcraft. 
<br /> And matching ids in an interesting variety of array dimensionality</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	
	$.each(OptionsObject, function  (index, value) {
	
		var radioButtons = $(&#39;#optionsHolder input:radio[name=&#39;+index+&#39;]&#39;);		

		var selectedIndex = radioButtons.index(radioButtons.filter(&#39;:checked&#39;));
		
</code></pre>
						</td>
					</tr>
					<tr id="section_81">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_81">&#182;</a>
							</div>
							<p>Let's add some sanity checking...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		if (selectedIndex &lt;0){
			hasError ++;
			
			$(&quot;input:radio[name=&quot;+index+&quot;]:first&quot;).attr(&#39;checked&#39;, true);	
			
			
			
					var radioButtons = $(&#39;#optionsHolder input:radio[name=&#39;+index+&#39;]&#39;);		

					var selectedIndex = radioButtons.index(radioButtons.filter(&#39;:checked&#39;));

		/* 	alert(selectedIndex);
			
			_f__warnDefaulted(index, &quot;0&quot;); */
			
</code></pre>
						</td>
					</tr>
					<tr id="section_82">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_82">&#182;</a>
							</div>
							<p>Let's just default</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>			OptionsObject[index] = &quot;0&quot;;
		}
		else
		{
		OptionsObject[index] =   radioButtons.filter(&#39;:checked&#39;).prop(&#39;value&#39;)   ;
		}
	
		 
	  });
	
	if(hasError &gt; 0)
	{
		_f__SaveOptionsCookie(OptionsObject);
		_f__GetGlobalOptions(OptionsObject);
		/* _f__warnP(&quot;A recoverable error was encountered in the physical widget settings\n Please try again&quot;); */
	}
	
</code></pre>
						</td>
					</tr>
					<tr id="section_83">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_83">&#182;</a>
							</div>
							<p>optional sanity expose</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	 /*var statement = &quot;&quot;;
	  $.each(OptionsObject, function  (index, value) {
	  statement += index + &quot; is &quot;+value+&quot;\n&quot;;  
	  });
	alert (statement);*/
</code></pre>
						</td>
					</tr>
					<tr id="section_84">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_84">&#182;</a>
							</div>
							<p>should really save options to record here... 
flags forced to global options values on load by default</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>}

</code></pre>
						</td>
					</tr>
					<tr id="section_85">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_85">&#182;</a>
							</div>
							<p>used to actually set the values in the radio boxes for the options object</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SetWidgetStateFromOptionsObject(reference) {

    $.each(reference,

        function (index, value) {
            $(&quot;input[name=&quot; + index + &quot;][value=&quot; + value + &quot;]&quot;).prop(&#39;checked&#39;, true);

            var indexCopy = index.toString();

            var forbiddenChars = new RegExp(&quot;[^a-zA-Z0-9]&quot;, &#39;g&#39;);
            if (forbiddenChars.test(index)) {
                indexCopy = index.replace(forbiddenChars, &#39;&#39;);
            }
       
		   
</code></pre>
						</td>
					</tr>
					<tr id="section_86">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_86">&#182;</a>
							</div>
							<p>default when something bad happens</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		   if(!$.isNumeric(value)){ _f__warnDefaulted(index, value); value = &quot;0&quot;  };
		    if(parseFloat(value) &lt; 0 ){ _f__warnDefaulted(index, value); value = &quot;0&quot;  };
		   
            _f__SetTovalue(&#39;OptionsObject.&#39; + indexCopy, value);
            _f__SetTovalue(indexCopy, value);
        })
}

</code></pre>
						</td>
					</tr>
					<tr id="section_87">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_87">&#182;</a>
							</div>
							<p>used to set vars after cleansing. shudder :see<em>no</em>evil:</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SetTovalue(varString, value) {
    eval(varString + &quot; = &quot; + value);
}

</code></pre>
						</td>
					</tr>
					<tr id="section_88">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_88">&#182;</a>
							</div>
							<p>For self-describing</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>var allfunctions=[];
function _f__GetAllFunctions(){ 
       
          for ( var i in window) {
        if((typeof window[i]).toString()==&quot;function&quot;){
            allfunctions.push(window[i].name);
          }
       }
	   
</code></pre>
						</td>
					</tr>
					<tr id="section_89">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_89">&#182;</a>
							</div>
							<p>Sort on the alpha values of the array.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    allfunctions.sort(function  (a, b) {
      return a.toUpperCase().localeCompare(b.toUpperCase());
    });
	   
	   
	var holder = [];   
	   
</code></pre>
						</td>
					</tr>
					<tr id="section_90">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_90">&#182;</a>
							</div>
							<p>remove empty entries</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    allfunctions = $.grep(allfunctions, function  (n, index) {
	  return  n.contains(&#39;_f__&#39;)  
	  });
	   
	   PrintArray(allfunctions);

	   }

	   
	   
</code></pre>
						</td>
					</tr>
					<tr id="section_91">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_91">&#182;</a>
							</div>
							<p>SaveChangesGetChart
Actually process the TOB DOB etc data and call a perl script via ajax to populate values via ephe data</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>function _f__SaveChangesGetChart(NameOfColumn) {

var IsSubjectSave = false;

if (NameOfColumn == &quot;subject&quot;) {
	 IsSubjectSave = true;
 
	 }

    var humDate = new Date();
				
    var timezone = &quot;&quot;;
			
    var error = 0;

	
</code></pre>
						</td>
					</tr>
					<tr id="section_92">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_92">&#182;</a>
							</div>
							<p>now do the TIME</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_93">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_93">&#182;</a>
							</div>
							<p>work out which node to use first.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>var activeLonNode = &quot;&quot;;
var activeLatNode = &quot;&quot;;
var activeDobNode = &quot;&quot;;	
var activeTobNode = &quot;&quot;;	
var activeAccNode = &quot;&quot;;

		if (IsSubjectSave)
	 {
		activeLonNode = $(&#39;#uk-lon&#39;);
		activeLatNode =$(&#39;#uk-lat&#39;);
		activeDobNode = $(&#39;#uk-dob&#39;);
		activeTobNode =$(&#39;#uk-tob&#39;);
		activeAccNode =$(&#39;#uk-acc&#39;);
	 }
	else	
	{
		activeLonNode = $(&#39;#uk-lon-tar&#39;);
		activeLatNode =$(&#39;#uk-lat-tar&#39;);
		activeDobNode =$(&#39;#uk-dob-tar&#39;);
		activeTobNode =$(&#39;#uk-tob-tar&#39;);
		activeAccNode =$(&#39;#uk-acc-tar&#39;);
	}	
	
	
    if (activeLatNode.val() == &quot;&quot;) {
        error = 1;
		 _f__warnClear();
	  _f__warnP(&quot;Enter valid decimal longitude, e.g &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;strong&gt;53.3&lt;/strong&gt;&quot;);
	  activeLatNode.focus();
	  return;
    }

    if (activeLonNode.val() == &quot;&quot;) {
        error = 1;
		_f__warnClear();
	  _f__warnP(&quot;Enter valid decimal latitude, e.g &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;strong&gt;-1.3&lt;/strong&gt;&quot;);
	  activeLonNode.focus();
	  return;
    }


    var splitted = activeDobNode.val().split(&#39; &#39;);
    var splittedTime = activeTobNode.val().split(&#39; &#39;);
</code></pre>
						</td>
					</tr>
					<tr id="section_94">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_94">&#182;</a>
							</div>
							<p>remove empty entries</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    splitted = $.grep(splitted, function  (n) {
        return n.length &gt; 0 || n
    });
</code></pre>
						</td>
					</tr>
					<tr id="section_95">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_95">&#182;</a>
							</div>
							<p>remove empty entries</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    splittedTime = $.grep(splittedTime, function  (n) {
        return n.length &gt; 0 || n
    });

</code></pre>
						</td>
					</tr>
					<tr id="section_96">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_96">&#182;</a>
							</div>
							<p>warn dob</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    if (activeDobNode.val() == &quot;00 00 0000&quot;) {
        error = 1;

        _f__warnP(&quot;ENTER DATE OF BIRTH\n\nDD MM YYYY\n\nLike 11 09 1974\n\nfor 11th Sept. 1974&quot;);
		return;
    }

    if (splittedTime.length != 2) {
        error = 1;
        _f__warnP(&quot;ENTER TIME OF BIRTH\n\nHH MM\n\nLike 13 00\n\nfor 1 PM&quot;);
		return;
    } else {
</code></pre>
						</td>
					</tr>
					<tr id="section_97">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_97">&#182;</a>
							</div>
							<p>no error</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    }

    if (splitted.length != 3) {
        error = 1;
        _f__warnP(&quot;ENTER DATE OF BIRTH\n\nDD MM YYYY\n\nLike 11 09 1974\n\nfor 11th Sept. 1974&quot;);
		return;
    } else {
</code></pre>
						</td>
					</tr>
					<tr id="section_98">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_98">&#182;</a>
							</div>
							<p>no error</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    }

</code></pre>
						</td>
					</tr>
					<tr id="section_99">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_99">&#182;</a>
							</div>
							<p>Total fail coverance.</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>	if(error == 1)
	{
	  _f__warnClear();
	  _f__warnP(&quot;Please enter valid birth data&quot;);
	return;
	  }
	  
</code></pre>
						</td>
					</tr>
					<tr id="section_100">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_100">&#182;</a>
							</div>
							<p>we made it - do something</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>    if (error == 0) {
        var dayOB = splitted[0];
        var monOB = splitted[1];
        var yearOB = splitted[2];

        var minOB = splittedTime[1];
        var hourOB = splittedTime[0];


        OptionsObjectDateTime = new Date(Date.UTC(yearOB, (parseFloat(monOB) - 1), dayOB, hourOB, minOB));
        humDate = new Date(Date.UTC(yearOB, (parseFloat(monOB) - 1), dayOB, hourOB, minOB));



       	/* 			var timestamped = moment(humDate).unix(); */
</code></pre>
						</td>
					</tr>
					<tr id="section_101">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_101">&#182;</a>
							</div>
							<p></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        var TimeZoneName = &quot;&quot;;
        var TimeZoneId = &quot;&quot;;
        var RawOffset = 0;
        var DstOffset = 0;
        var TotalOffset = 0;
</code></pre>
						</td>
					</tr>
					<tr id="section_102">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_102">&#182;</a>
							</div>
							<p>stubs for ajax timezone lookups</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        /*     var url = &quot;https://maps.googleapis.com/maps/api/timezone/json?location=&quot;+$(&#39;#uk-lat&#39;).val()+&quot;,&quot;+$(&#39;#uk-lon&#39;).val()+&quot;&amp;timestamp=&quot; + timestamped ;
            $.ajax({
              url: url,
            }).done(function(response) {
        
        	TimeZoneName = copy(response.timeZoneName.toString());
        	TimeZoneId = copy(response.timeZoneId.toString());
        
        	if ($.isNumeric(parseFloat(copy(response.rawOffset)))){  OptionsObjectUtOffset=  parseFloat(copy(response.rawOffset)); RawOffset +=  parseFloat(copy(response.rawOffset)); }
        
        	if ($.isNumeric( parseFloat(copy(response.dstOffset))) ) {OptionsObjectDstOffset=parseFloat(copy(response.dstOffset)); DstOffset +=  parseFloat(copy(response.dstOffset));	} */
</code></pre>
						</td>
					</tr>
					<tr id="section_103">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_103">&#182;</a>
							</div>
							<p></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        TotalOffset += RawOffset;
        TotalOffset += DstOffset;
</code></pre>
						</td>
					</tr>
					<tr id="section_104">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_104">&#182;</a>
							</div>
							<p></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        humDate.setSeconds(humDate.getSeconds() + TotalOffset);
</code></pre>
						</td>
					</tr>
					<tr id="section_105">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_105">&#182;</a>
							</div>
							<p></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        /*   debugP(&quot;The timezone for &quot;+TimeZoneName+&quot;, is &quot; + TimeZoneId + &quot;, BST offset: &quot; +DstOffset+ &quot;,\n\n Total offset for that place/date is &quot;+copyOfResponse+ &quot;secs\n\nGiving us a final place/date timedate of &quot;+humDate);
        
        	
            },0);
        			
        	  debugP(&quot;The timezone for &quot;+TimeZoneName+&quot;, is &quot; + TimeZoneId + &quot;, BST offset: &quot; +DstOffset+ &quot;,\n\n Total offset for that place/date is &quot;+copyOfResponse+ &quot;secs\n\nGiving us a final place/date timedate of &quot;+humDate); */
</code></pre>
						</td>
					</tr>
					<tr id="section_106">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_106">&#182;</a>
							</div>
							<p></p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_107">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_107">&#182;</a>
							</div>
							<p>sanity checks
using the String.prototype.IsDefault and Number.prototype.IsDefault functions</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>		if( lat.IsDefault  )
		{            
	lat = activeLatNode.val();			}

        if (lon.IsDefault ) 
		{            
	lon = activeLonNode.val();        };

</code></pre>
						</td>
					</tr>
					<tr id="section_108">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_108">&#182;</a>
							</div>
							<p>ternary  - makes a true be a 1</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        if (acc.IsDefault) 
		{           
	acc = 1 * (activeAccNode.is(&#39;:checked&#39;))         };
		
</code></pre>
						</td>
					</tr>
					<tr id="section_109">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_109">&#182;</a>
							</div>
							<p>double check if we got junk from the boxes...</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        if (lat.length == 0) {
            lat = &quot;0&quot;;
			activeLatNode.focus();
			_f__warnP(&quot;Enter a decimal latitude value&quot;);
			return;
        };
        if (lon.length == 0) {
            lon = &quot;0&quot;;
			activeLonNode.focus();
			_f__warnP(&quot;Enter a decimal longitude value&quot;);
			return;
        };

		
</code></pre>
						</td>
					</tr>
					<tr id="section_110">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_110">&#182;</a>
							</div>
							<p>build command</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
	/* 	var dayOB = splitted[0];
        var monOB = splitted[1];
        var yearOB = splitted[2];

        var minOB = splittedTime[1];
        var hourOB = splittedTime[0]; */
		
		 var dataString = &#39;dob=&#39; +dayOB+&#39;/&#39;+monOB+&#39;/&#39;+yearOB+ &#39;&amp;tob=&#39;+hourOB+&quot;:&quot;+minOB + &#39;&amp;lat=&#39; + lat.toString().trim() + &#39;&amp;lon=&#39; + lon.toString().trim() + &#39;&amp;acc=&#39; + acc.toString();
		
</code></pre>
						</td>
					</tr>
					<tr id="section_111">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_111">&#182;</a>
							</div>
							<p>var dataString = 'dob=' + moment(humDate).format('DD/MM/YYYY').trim() + '&amp;tob=' + moment(humDate).format('hh:mm').trim() + '&amp;lat=' + lat.trim() + '&amp;lon=' + lon.trim() + '&amp;acc=' + acc;</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>
</code></pre>
						</td>
					</tr>
					<tr id="section_112">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_112">&#182;</a>
							</div>
							<p>make request</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>        $.ajax({

            type: &quot;POST&quot;,
            url: &quot;./cgi-bin/chart.pl?&quot;,
            data: dataString,
            success: function  (response) {
                $(&quot;#ScriptingInjectionPoint&quot;).html(response);

             /* alert( &quot;Load was performed. dob:&quot;+dob+&quot; tob:&quot;+tob+&quot; lon:&quot;+lon+&quot; lat:&quot;+lat+&quot; response:&quot;+response   ); */

                setTimeout(function  () {
                    _f__populateBoxesFromDatastream(NameOfColumn);
                }, 100);
                return false;
            }
        });
    }
</code></pre>
						</td>
					</tr>
					<tr id="section_113">
						<td class="docs">
							<div class="pilwrap">
								<a class="pilcrow" href="#section_113">&#182;</a>
							</div>
							<p>we are done</p>

						</td>
						<td class="code">
							<pre><code class='prettyprint'>}
	   
</code></pre>
						</td>
					</tr>
			</tbody>
		</table>
	</div>
</body>
</html>
